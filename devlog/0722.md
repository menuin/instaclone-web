# ğŸ¥‘ DEVLOG 7/22



- ëª¨ë“  iconì€ ê¸°ë³¸ì ìœ¼ë¡œ svg ì´ë¯€ë¡œ svg ì‚¬ì´ì¦ˆë¥¼ ë°”ê¾¸ë©´ icon ì‚¬ì´ì¦ˆë„ ë°”ë€œ

### #11.6 isLiked

- ë‚´ê°€(loggedInUser) ì¢‹ì•„ìš”í•œ ì‚¬ì§„ì—ëŠ” ì´ë¯¸ í•˜íŠ¸ê°€ ì±„ì›Œì ¸ ìˆì–´ì•¼ í•˜ëŠ”ë° ì§€ê¸ˆ ì•ˆê·¸ëŸ¼ => photo resolverì— isLikedë¥¼ ë§Œë“¤ì§€ ì•Šì•˜ê¸° ë•Œë¬¸(photoë¥¼ ë³´ê³ ìˆëŠ” ìœ ì €ê°€ ì´ë¯¸ ì´ ì‚¬ì§„ì„ ì¢‹ì•„í•œë‹¤)

- ë°±ì—”ë“œì— isLiked ë§Œë“¤ê¸° (ì½”ë“œ ì°¸ê³ )

- apollo dev toolì˜ cacheì—ì„œ isLiked ì—¬ë¶€ í™•ì¸

- solid iconì—ì„œ faHeart ì„í¬íŠ¸

```js
import { faHeart as SolidHeart } from "@fortawesome/free-solid-svg-icons";
...
<PhotoAction>
	<FontAwesomeIcon 
		style={{ color: photo.isLiked ? "tomato" : "inherit" }} 
    	icon={photo.isLiked ? SolidHeart : faHeart} />
</PhotoAction>
```



### #11.7 Liking Photos

- cleaning the previous codes (components/feed/Photo.jsë¡œ ë‹¤ ì˜®ê¸°ê¸°)

- Proptypesë„ ë§Œë“¤ê¸°

```js
// Home.js
{data?.seeFeed?.map(photo => <Photo key={photo.id} {...photo} />)}
// {...photo} : sending all the props of photo , ëª¨ë“  PropTypesê°€ photoì˜ propertiesì™€ ê°™ë‹¤ë©´ ì‚¬ìš©ê°€ëŠ¥
```

- mutation (like, dislike : toggleLike)

1. write the mutation

```js
const TOGGLE_LIKE_MUTATION = gql`
    mutation toggleLike($id :Int!){
        toggleLike(id:$id){
            ok
            error
        }
    }
`
```

2. use the mutation

```js
const [toggleLikeMutation, {loading}]= useMutation(TOGGLE_LIKE_MUTATION, {
        variables:{
            id,
        }
    })

...
<PhotoAction onClick={toggleLikeMutation}>
    // heart icon
</PhotoAction>
```



### #11.8 Refetching queries

- updating apollo cache
- Likes+1, í•˜íŠ¸ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ(isLiked => true)

1. **ê°„ì ‘ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ê¸°(refetching query)**
   - mutationì´ ì •ìƒì ìœ¼ë¡œ ì™„ë£Œë˜ë©´ ì ì–´ë†“ì€ ì¿¼ë¦¬ë¥¼ refetch 

```js
const [toggleLikeMutation, { loading }] = useMutation(TOGGLE_LIKE_MUTATION, {
    variables: {
        id,
    },
    refetchQueries: [{ query: FEED_QUERY, variables: {í•„ìš”í•œ variablesì—¬ê¸°ë‹¤ ì ê¸°} }],
})
```

- feed ì „ì²´ë¥¼ ë‹¤ì‹œ í˜¸ì¶œí•˜ê¸° ë•Œë¬¸ì— ì¢‹ì€ ë°©ë²•ì€ ì•„ë‹˜(ì •ë§ ì‘ì€ ì¿¼ë¦¬ì¸ê²½ìš° ì‚¬ìš©í•´ë„ ë¬¸ì œx)
- prototypeì—ì„œ ì‚¬ìš©ê°€ëŠ¥, ì‹¤ì œì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©x

2. **fragmentsë¥¼ ì´ìš©**

- update cache



### #11.9 writeFragment

- ìºì‹œ ì§ì ‘ì ìœ¼ë¡œ ìˆ˜ì •

- update : apollo cacheì— link + ë°±ì—”ë“œì—ì„œ ì˜¨ ë°ì´í„°

```js
const updateToggleLike = (cache, result) => {
    const {
        data: {
            toggleLike: { ok },
        },
    } = result; // ë°±ì—”ë“œ ë°ì´í„°
    if (ok) {
        console.log("now its time to update cache")
    }
}

const [toggleLikeMutation, { loading }] = useMutation(TOGGLE_LIKE_MUTATION, {
    variables: {
        id,
    },
    update: updateToggleLike,
})
```

- **writeFragment** : cacheì—ì„œ ì›í•˜ëŠ” íŠ¹ì • objectì˜ ì¼ë¶€ë¶„ì„ ìˆ˜ì •
  1. writeí•˜ê³  ì‹¶ì€ fragmentë‚˜ elementì˜ id
  2. fragment ì‘ì„± (fragment (ì•„ë¬´ ì´ë¦„) on (writeí•˜ê³  ì‹¶ì€ type))

```js
if (ok) {
    cache.writeFragment({
        id : `Photo:${id}`, // ë°”ê¾¸ë ¤ê³  í•˜ëŠ” photo 
        fragment : gql`
			fragment BSName on Photo {
				isLiked // ìˆ˜ì •í•  ë¶€ë¶„
				likes
			}
`,
        data : {
            isLiked : !isLiked, // toggle
            likes: isLiked ? likes - 1 : likes + 1,
        }
    })
}
```



### #11.10 readFragment

- í˜„ì¬ object ì •ë³´ê°€ ì—†ëŠ” ê²½ìš° (í˜„ì¬ isLiked, likes) >> cacheì—ì„œ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ê¸°(local)(**readFragment**)
- readFragment, writeFragment >> ë°±ì—”ë“œì— í¬ê²Œ ì˜ì¡´í•˜ì§€ ì•Šê³  í›¨ì”¬ ë¹ ë¥´ê²Œ ì‘ë™

```JS
if (ok) {
    const fragmentId = `Photo:${id}`
    const fragment = gql`
        fragment BSName on Photo {
            isLiked
            likes
        }
		`
    const result = cache.readFragment({ // WriteFragmentë‘ í˜•ì‹ ë™ì¼
        id: fragmentId,
        fragment: fragment,
    });

    if ("isLiked" in result && "likes" in result) {
        const { isLiked: cacheIsLiked, likes: cacheLikes } = result;
        cache.writeFragment({
            id: fragmentId,
            fragment: fragment,
            data: {
                isLiked: !cacheIsLiked,
                likes: cacheIsLiked ? cacheLikes - 1 : cacheLikes + 1,
            }
        })
    }

        }
```



### #11.11 Comments part 1

- ì½”ë“œ í™•ì¸ + ë°±ì—”ë“œ ì½”ë“œ ìˆ˜ì •



### #11.12 Comments part 2

- painting comments
- component "comments" >> comment form ë§Œë“¤ê±°ì„
- component "comment" >> parsing hashtags / deletion 



### #11.13 Parsing Hashtags

- hashtag ì°¾ì•„ì„œ íŒŒë—ê²Œ í•˜ê¸°
- regex ì‚¬ìš© (ì°¸ê³  : https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/String/replace)

```js
const caption = "I love #toast in the #morning";
console.log(caption.replace(/#[\w]+/g,"potato"));
// >> "I love potato in the potato"
console.log(caption.replace(/#[\w]+/g,$&));
// >> "I love #toast in the #morning" (ë§¤ì¹˜ëœ ë¬¸ìì—´ì„ ê·¸ëŒ€ë¡œ ì‚½ì…)
console.log(caption.replace(/#[\w]+/g,"<mark>$&</mark>"));
// ìœ ì €ê°€ ì–´ë–¤ ìœ„í—˜í•œ htmlì½”ë“œë¥¼ ë„£ì„ì§€ ëª¨ë¥´ê¸°ë•Œë¬¸ì— ë¦¬ì•¡íŠ¸ëŠ” íƒœê·¸ë„ stringìœ¼ë¡œ ë³´ì—¬ì¤Œ
// >> "I love <mark>toast</mark> in the <mark>morning</mark>"
```

- **dangerouslySetInnerHTML** : htmlíƒœê·¸ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ prop

```js
<CommentContainer>
    <FatText>{author}</FatText>
	<CommentCaption dangerouslySetInnerHTML={{
		__html: payload.replace(/#[\w]+/g, "<mark>$&</mark>")
	}} />
</CommentContainer>
```

- ìœ ì €ë¥¼ ë„ˆë¬´ ì‹ ë¢°í•˜ê³  ìˆìŒ! >> sanitize-htmlë¡œ html ì²­ì†Œ(í—ˆìš©ëœ íƒœê·¸ë§Œ ì‚¬ìš©ê°€ëŠ¥í•˜ê²Œ)
  - npm i sanitize-html

```js
function Comment({ author, payload }) {
    const cleanedPayload = sanitizeHtml(payload.replace(/#[\w]+/g, "<mark>$&</mark>"), {
        allowedTags: ["mark"],  // <mark>ë§Œ í—ˆìš©
    })

    return (
        <CommentContainer>
            <FatText>{author}</FatText>
            <CommentCaption dangerouslySetInnerHTML={{
                __html: cleanedPayload,
            }} />
        </CommentContainer>
    )
}
```

