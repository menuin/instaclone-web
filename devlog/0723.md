# ğŸŒµ DEVLOG 7/23

### #11.14 Parsing hashtags part 2

- ë¬¸ì œ : hashtag is not clickable ! - <a href="">ë¡œ í• ìˆ˜ë„ ìˆì§€ë§Œ allowed tagsì— aíƒœê·¸ë¥¼ ì¶”ê°€í•˜ë©´ ìœ ì €ê°€ linkë¥¼ ì¨ë„£ì„ ìˆ˜ ìˆê²Œë˜ê¸° ë•Œë¬¸ì— ì•ˆë¨ 

- react-router-link ëŠ” sanitized htmlì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ >> htmlì´ê¸° ë•Œë¬¸
- sanitized html ì ìš© ì „ ìƒíƒœë¡œ ê°€ì„œ hashtagë¥¼ ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ë¡œ ëŒ€ì²´í•˜ê¸°

```js
const paylod = "i love #avocado";
payload.split(" ").map(word => /#[\w]+/.test(word));
// ê° ë‹¨ì–´ê°€ regexì™€ ë§ëŠ”ì§€ test (list of booleansë¡œ ë°˜í™˜)
payload.split(" ").map(word => /#[\w]+/.test(word) ? `<RL>${word}</RL>` : word);
// ë‹¨ì–´ê°€ regexì™€ ì¼ì¹˜í•˜ë©´ íƒœê·¸ë¡œ ê°ì‹¼ ë‹¨ì–´ ë°˜í™˜
payload.split(" ").map(word => /#[\w]+/.test(word) ? `<RL>${word}</RL>` : word).join(" ");
// ë‹¨ì–´ì‚¬ì´ ê³µë°± ë„ìš°ê³  concatenate
```

- ì ìš©

```js
<CommentCaption>{payload.split(" ").map(word => /#[\w]+/.test(word) ? <Link to={`/hashtag/${word}`}>{word}</Link> : {word})}</CommentCaption>
```

- ê¸°íƒ€ : 

  - ê³µë°±í•œì¹¸ ë„ìš°ê¸°

  - fragmentë¡œ ê°ì‹¸ê¸°

  - key ì œê³µ

  - í•´ì‹œíƒœê·¸ê°€ ì•„ë‹Œ wordì— ëŒ€í•´ì„œëŠ” fragmen<>ë‚´ì— keyë¥¼ ë„£ì„ ìˆ˜ ì—†ìŒ

    <React.Fragment> ì‚¬ìš©í•˜ë©´ keyë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìŒ

    ```js
    <React.Fragment key={index}>
        {word}{" "}
    </React.Fragment>
    ```



### #11.15 Cache modify

- better-easier(than writeFragment) way for changing cache

- **cache.modify()** << new!! (apollo 3)

  - ë°”ê¾¸ë ¤ëŠ”í•„ë“œëª…(previousê°’){

    â€‹	return ë°”ê¾¸ë ¤ëŠ” ê°’}

```js
if (ok) {
    const photoId = `Photo:${id}`
    cache.modify({
        id: photoId, // modifyí•˜ë ¤ëŠ” element
        fields: {
            isLiked(prev) {
                return !prev;
            },
            likes(prev) {
                if (isLiked) {
                    return prev - 1;
                }
                return prev + 1;
            }
        }
    })
}
```



### #11.16 Create Comment part 1

- useForm hook
  - inputì— ë°˜ë“œì‹œ name ìˆì–´ì•¼ í•¨

```js
const {register, handleSubmit } = useFom();
const onValid = (data) => { // dataëŠ” formì´ ê°€ì§„ ê°’
	const {payload} = data;
}
...

<div>
	<form onSubmit={handleSubmit(onValid)}>
		<input
			name="payload"
            {...register('payload', { required: true })}
			type="text"
			placeholder="Write a comment. . ."
		/>
    </form>
</div>
```

- mutation ì‘ì„±  (ì½”ë“œ í™•ì¸)

  `createComment($photoId:$photoId!, payload:String!)`

- createCommentMutationì€ photoIdë¥¼ í•„ìš”ë¡œ í•¨(Comments ì»´í¬ë„ŒíŠ¸ë¡œ ì „ë‹¬ë˜ê³  ìˆì§€ ì•ŠìŒ) >> Photo.js ìˆ˜ì •

- Mutation ì‚¬ìš©

```js
const [createCommentMutation, {loading}] = useMutation(CREATE_COMMENT_MUTATION);
const { register, handleSubmit } = useForm();
const onValid = (data) => {
    if (loading){
        return;
    }
    createCommentMutation({
        variables: {
            photoId,
            payload,
        }
    })
}
```

- comment ë¥¼ ì…ë ¥í•œ í›„ ì…ë ¥ì°½ ë¹„ìš°ê¸° (setValue)

```js
const { register, handleSubmit, setValue } = useForm();
const onValid = (data) => {
    ...
    setValue("payload", "");
}
```

- commentë¥¼ ì…ë ¥í•œ í›„ (ìƒˆë¡œê³ ì¹¨ì—†ì´) ë°”ë¡œ ë³´ì´ê²Œ í•˜ê¸°



### #11.17 Create Comment part 2

- comment ì‘ì„±í•˜ë©´(í•˜ê³  submití•˜ë©´) comment ê°œìˆ˜+1 í•˜ê³  listì— ë°”ë¡œ ë³´ì—¬ì£¼ê¸°

- cacheì— fake comment ë§Œë“¤ê¸° (idë¥¼ ì œì™¸í•œ ê²ƒë“¤ì€ ìœ„ì¡° ê°€ëŠ¥, idëŠ” dbì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨(commentë¥¼ ì‚­ì œí•˜ê¸° ìœ„í•´ì„œ í•„ìš”))

  - backend ìˆ˜ì •(MutationResponseì— idí¬í•¨ì‹œí‚¤ê¸°)

  ```js
  // createComment.resolvers.js
  const newComment = await client.comment.create({
  	...
  });
  return {
      ok: true,
      id: newComment.id,
  }
  ```

  

- useMutation

```js
const [createCommentMutation, { loading }] = useMutation(CREATE_COMMENT_MUTATION, {
    update: createCommentUpdate,
    // cacheì™€ mutationìœ¼ë¡œ ë°›ì•„ì˜¨ ë°ì´í„°ë¥¼ createCommentUpdateë¡œ ë„˜ê²¨ì¤€ë‹¤
});
```

- createCommentUpdate
  - userData (#11.1) : localStorageì— ìˆëŠ” í† í° ê¸°ë°˜ìœ¼ë¡œ ìœ ì € ì°¾ì•„ì˜´~!
  - onValidê°€ ë¨¼ì € ì‹¤í–‰ë˜ë‹ˆ `setValue("payload", "");`ë¥¼ onValidì— ë„£ê²Œë˜ë©´ newCommentì—ì„œ payloadê°€ empty stringì´ ë¨

```js
const { data: userData } = useUser();

const createCommentUpdate = (cache, result) => {
        const { payload } = getValues();  // formì— ì…ë ¥í•œ ê°’ ë½‘ê¸°
        setValue("payload", "");         // form inputê°’ ì´ˆê¸°í™”

        const {
            data: {
                createComment: { ok, id },
            },
        } = result; // createComment mutationìœ¼ë¡œ ë°›ì•„ì˜¨ ë°ì´í„°

        if (ok && userData?.me) {
            const newComment = {
				__typename: "Comment",
                createdAt: Date.now(),
                id,  // dbì—ì„œ ê°€ì ¸ì˜¨ comment ID
                isMine: true,
                payload,
                user: {
                    ...userData.me,
                },
            };
            console.log(newComment);
        }
    }
```

- cache.modify()
  - ê¸°ì¡´ comments arryì— newCommentë¥¼ ì¶”ê°€í•œ array return 

```js
cache.modify({
    id: `Photo:${photoId}`,
    fields: {
        comments(prev) {
            return [...prev, newComment];
        },
        commentNumber(prev) {
 			return prev + 1;
		}
    }
})
```

=> commentë¥¼ ì…ë ¥í•˜ëŠ” ì¦‰ì‹œ í™”ë©´ì— updateí•  ìˆ˜ ìˆìŒ~!~





