# ğŸ¦ DEVLOG 7/20



### #10.13 Redirecting users

**í˜ì´ì§€ ê°„ ì´ë™í•  ë•Œ ì•Œë¦¼ì¶”ê°€(ex.íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŒ)**

- redirect with states (routeì— state ì „ë‹¬)

  `history.push(routes.home,{message:"Account created. Please log in"});`

  ğŸ’¦ hashRouterë¥¼ ì‚¬ìš©í•˜ë©´ ì—ëŸ¬ `Warning: hash history cannot push state it is ignored` : ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„± -`history.push({ pathname: routes.home, message: "Account created. Please log in" });`

- useLocation (hook) : í˜„ì¬ ë¨¸ë¬´ë¥´ëŠ” í˜ì´ì§€ì— ëŒ€í•œ ì •ë³´ë¥¼ ì•Œë ¤ì£¼ëŠ” hook

```js
// Login.js
function Login() {
    const location = useLocation();
    console.log(location);
// ìœ„ì—ì„œ ì „ë‹¬í•œ pathname, messageê°€ ë‹´ê¸´ object ì „ë‹¬
```

- Notification component ë§Œë“¤ê¸°

```js
// Login.js
<Notification>{location?.message}</Notification>  // hashRouter
<Notification>{location?.state?.message}</Notification> // browserRouter
```

- usernameê³¼ passwordë„ í•¨ê»˜ ë³´ë‚´ê¸° (ë¡œê·¸ì¸í˜ì´ì§€ì—ì„œ ë°”ë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆë„ë¡)
  - getValues()

```js
const onCompleted = (data) => {
    const {username, password} = getValues();
    history.push({
        pathname : routes.home,
        message : "Account created. Please log in",
        username,
        password,
    })
}
```

- - defaultValues

```js
// Login.js
... = useForm({
    mode:"onChange",
    defaultValues : {
        username : location?.username || "",
        password : location?.password || "",
    }
})
```



### #10.14 Dark mode

1. ë²„íŠ¼

```JS
// AuthLayout.js
const darkMode = useReactiveVar(darkModeVar);
...
<DarkModeBtn onClick = {darkMode ? disableDarkmode : enableDarkMode}>
```

2. enable/disableDarkMode

```js
// apollo.js
export const enableDarkMode = () => {
    localStorage.setItem(DARK_MODE, "enabled");
    darkModeVar(true);
}
```



### #11.0 Header and Layout

- í˜„ì¬ header -> app.jsì—

```js
<Router>
    <Header />
    	<Switch>
    		...
```

- ê±°ì˜ ëª¨ë“  routeì— headerê°€ ìˆì—ˆìœ¼ë©´ ì¢‹ê² ìŒ(**ë¡œê·¸ì¸, ê°€ì…í• ë•Œ ë¹¼ê³ **) => headerë‘ ê°™ì´ routeë¥¼ ë Œë”ë§í•´ì¤„ ì»´í¬ë„ŒíŠ¸ ë§Œë“¤ê¸°
  - ì»´í¬ë„ŒíŠ¸ Layoutì€ childrenê³¼ headerë¥¼ ê°™ì´ ë Œë”ë§

```js
// Layout.js
const Content = styled.main`
    margin-top : 45px;
    max-width : 930px;
    width:100%;
    margin : 0 auto;
`
function Layout({ children }) {
    return (
        <>
            <Header />
            <Content>
                {children}
            </Content>
        </>
    );
}
```

- ë¡œê·¸ì¸ë˜ì–´ìˆì„ë•Œë§Œ headerê°€ ë‚˜íƒ€ë‚˜ë„ë¡

```js
// App.js
<Route path={routes.home} exact>
    {isLoggedIn ? (
     	<Layout>
     		<Home />  // children
     	</Layout>) 
     	: 
     	<Login />}
```



### #11.1 Header part 2

- ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ì—¬ë¶€ì— ë”°ë¼ headerê°€ ë‹¤ë¥´ê²Œ ë³´ì´ë„ë¡

- ë¡œê·¸ì¸ì´ ë˜ì—ˆì„ ë•Œ ì•„ì´ì½˜ ë³´ì—¬ì£¼ê¸° / ë¡œê·¸ì¸ ì•ˆë˜ì—ˆì„ ê²½ìš° ë¡œê·¸ì¸ ë²„íŠ¼(Link, Button component)

```js
function Header() {
	const isLoggedIn = useReactiveVar(isLoggedInVar);
// localStorageì— í† í°ì´ ìˆìœ¼ë©´ true
    
    ...
    {isLoggedIn ? <>
         <Icon>
         	<FontAwesomeIcon icon={faHome} size="lg" />
         </Icon>
        <Icon>
             <FontAwesomeIcon icon={faCompass} size="lg" />
        </Icon>
        <Icon>
        	<FontAwesomeIcon icon={faUser} size="lg" />
        </Icon></> : (
                        <Link href={routes.home}>
                            <Button>Login</Button>
                        </Link>
                    )}
}
```

ğŸ’¡ğŸ’¡ğŸ’¡ **ë¦¬ì•¡íŠ¸ëŠ” í•˜ë‚˜ì˜ ì»´í¬ë„ŒíŠ¸ë§Œì„ ë¦¬í„´í•  ìˆ˜ ìˆë‹¤**(returnë¬¸ ì•ˆì— ë°˜ë“œì‹œ í•˜ë‚˜ì˜ ìµœìƒìœ„ íƒœê·¸ê°€ ìˆì–´ì•¼ í•œë‹¤) ê·¸ë ‡ê¸° ë•Œë¬¸ì— ì—¬ëŸ¬ê°œì˜ ìì‹ ì»´í¬ë„ŒíŠ¸ë¥¼ ë¦¬í„´í•˜ê¸° ìœ„í•´ì„œ **<> (fragment)**ë¥¼ ë°˜ë“œì‹œ ì¶”ê°€í•œë‹¤

- `<div>`ë¡œ ë¬¶ëŠ”ë‹¤ë©´ ìƒìœ„ì—ì„œ ì˜ë¯¸ì—†ëŠ” `<div>`ê°€ ì¶”ê°€ë˜ì–´ì„œ ë‚˜íƒ€ë‚˜ì§€ë§Œ fragmentëŠ” ìƒìœ„ì—ì„œ í‘œí˜„ë˜ì§€ ì•ŠìŒ



- ë¬¸ì œëŠ” isLoggedInì€ localStorageì— í† í°ì´ ì¡´ì¬í•˜ëŠ”ì§€ë§Œ í™•ì¸í•˜ê¸° ë•Œë¬¸ì— ì¸ì¦ëœ í† í°ì´ ì•„ë‹ˆë”ë¼ë„ trueê°€ ë¨

1. ë°±ì—”ë“œì— me.typeDefs, me.resolvers

```js
// me.resolvers
export default {
    Query: {
        me: protectedResolver((_, __, { loggedInUser }) => client.user.findUnique({
            where: {
                id: loggedInUser.id,
            }
        }))
    }
}

// me.typeDefs
export default gql`
    type Query {
        me : User
    }
`
```

2. hooks/useUser.js

- useUser hook! >> ìœ ì € ì •ë³´ê°€ í•„ìš”í•  ë•Œ ì–´ë””ì„œë“  ì´ hookë¥¼ ì‚¬ìš©

- ìœ ì €ê°€ í† í°ì„ ê°€ì§€ê³  ìˆìœ¼ë©´ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ì§€ x

```js
const ME_QUERY = gql`
    query me {
        me {
            username
            avatar
        }
    }
`
function useUser() {
    const isLoggedIn = useReactiveVar(isLoggedInVar);
    const { data, error } = useQuery(ME_QUERY, {
        skip: !isLoggedIn
        // local Storageë¥¼ í†µí•´ ë¡œê·¸ì¸í•œ ê²½ìš°ê°€ ì•„ë‹ˆë©´ ì¿¼ë¦¬ë¥¼ skip 
    });

    console.log(data, error);
    return;
}
export default useUser;
```



### #11.2 Header part 3

- localStorageì— í† í°ì´ ìˆëŠ”ë° ìœ íš¨í•˜ì§€ ì•Šì€ í† í°ì´ë©´ me:null (meëŠ” protected) 
- data:{me:null} ì¸ê²½ìš° ìœ ì €ë¥¼ ë¡œê·¸ì•„ì›ƒ ì‹œí‚´(local storageì— í† í°ì´ ì¡´ì¬í•˜ì§€ë§Œ ë°±ì—”ë“œì—ì„œ í•´ë‹¹ í† í°ì„ ê°€ì§„ ìœ ì €ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ)

- useEffect : hookê°€ ë§ˆìš´íŠ¸ë  ë•Œ í•œë²ˆ ì‹¤í–‰, ë°ì´í„°ê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ì‹¤í–‰

```js
function useUser() {
    const hasToken = useReactiveVar(isLoggedInVar);
    const { data } = useQuery(ME_QUERY, {
        skip: !hasToken,
    });

    useEffect(() => {
        if (data?.me === null) {
            console.log("there is token on local storage but the token did not work on the backend");
        // ì´ ê²½ìš° ì‚¬ìš©ìë¥¼ ë¡œê·¸ì•„ì›ƒ ì‹œí‚´
        logUserOut();
        }
    }, [data]) // ë°ì´í„°ê°€ ë³€ê²½ë ë•Œë§ˆë‹¤ useEffect() ì‹¤í–‰
    return;    
}
```

- ê·¼ë° ë‹¤ì‹œ ë¡œê·¸ì¸í•˜ë©´ ë°”ë¡œ ë¡œê·¸ì•„ì›ƒë¨!!! >> ë°±ì—”ë“œê°€ í† í°ì— ë°˜ì‘í•˜ì§€ ì•Šê³  ìˆìŒ
  - ë¸Œë¼ìš°ì €ì˜ ì¿ í‚¤ëŠ” localhostì— ìš”ì²­í• ë•Œë§ˆë‹¤ ì „ì†¡ë˜ì§€ë§Œ í† í°ì€ ë‹¤ë¥´ë‹¤
  - request í—¤ë”ì— í† í°ì„ ë¶™ì—¬ì„œ ë³´ë‚´ì•¼í•¨ ë°±ì—”ë“œì—ì„œ í–ˆë˜ê±°ì²˜ëŸ¼! ê·¸ë‹ˆê¹Œ ì• ì´ˆì— ë°±ì—”ë“œë¡œ í† í°ì„ ë³´ë‚´ê³  ìˆì§€ ì•Šì•˜ë˜ ê±°ì„(?)

- setContext : í´ë¼ì´ì–¸íŠ¸ì˜ ëª¨ë“  requestì˜ contextë¥¼ ì„¤ì •

  setContext({ graphQL-request , previous-Context })

```js
// apollo.js

const httpLink = createHttpLink({
    uri: "http://localhost:4000/graphql",
})

const authLink = setContext((_, { headers }) => {
    return {
        headers: {
            ...headers,  // previous headers
            token: localStorage.getItem(TOKEN), // + new one (Token)
        }
    }
})
export const client = new ApolloClient({
    link: authLink.concat(httpLink),
    cache: new InMemoryCache(),
})
```

- ì´ì œ ë‹¤ì‹œ ë¡œê·¸ì¸í•´ë„ ê°•ì œë¡œ ë¡œê·¸ì•„ì›ƒ ë˜ì§€ ì•ŠìŒ~



### #11.3 Avatar

- í—¤ë”ì— avatar ì´ë¯¸ì§€ ë„ìš°ê¸°

```js
// Avatar.js
const SAvatar = styled.div`
    width : 18px;
    height : 18px;
    border-radius : 15px;
    background-color : #2c2c2c;
    overflow : hidden;             // SAvatar divë¥¼ ë„˜ì–´ê°€ë©´ hidden
`
const Img = styled.img`
    max-width: 100%;
`
function Avatar({ url = "" }) {
    return (<SAvatar>
        {url !== "" ? <Img src={url} /> : null}
    </SAvatar>)
}
```



```js
// useUser.js - useUserëŠ” dataë¥¼ ë¦¬í„´
return {data};

// Header.js
function Header(){
    const {data} = useUser();
    ...
    <Icon>
        <Avatar url={data?.me?.avatar} />
    </Icon>
}
```

â­â­â­â­ ë§¤ìš°ì¤‘ìš” : {data.me.avatar} ë¼ê³  ì“°ë©´ ì•ˆë¨ (dataê°€ ì—†ëŠ”ë° meë¥¼ ì°¾ìœ¼ë ¤ë©´ ì—ëŸ¬ >> ë¦¬ì•¡íŠ¸ëŠ” dataê°€ ì˜¬ë•Œê¹Œì§€ ê¸°ë‹¤ë ¸ë‹¤ê°€ ë³´ì—¬ì£¼ì§€ ì•ŠìŒ)  => ?ë¥¼ ë°˜ë“œì‹œ ë¶™ì—¬ì¤€ë‹¹

```js
<Icon>
    <Avatar url={data?.me?.avatar}/>
</Icon>
```



### #11.4 Photo component part 1

- home screen ë§Œë“¤ê¸°

1. ì¿¼ë¦¬ ë§Œë“¤ê¸°

```js
// Home.js
const FEED_QUERY = gql`
    query seeFeed {
        seeFeed {
            id
            user {
                username
                avatar
            }
            file
            caption
            likes
            comments
            createdAt
            isMine
        }
    }
`
// ì‚¬ìš©
const { data } = useQuery(FEED_QUERY); 
```

2. PhotoContainer / FatText(shared.jsì— ë„£ê³  extendí•´ì„œ ì‚¬ìš©)

```js
{data?.seeFeed?.map(photo =>
    <PhotoContainer key={photo.id}> // each child in a list should have a unique key prop.
        <PhotoHeader>
        	<Avatar url={photo.user.avatar} />
            <FatText>{photo.user.username}</FatText>
 		</PhotoHeader>
 	</PhotoContainer>)}
```



### #11.5 Photo component part 2

- í—¤ë” ë°‘ ë¶€ë¶„ (ì‚¬ì§„ & description & likes, comments ë“±ë“±)

1. photo
   - ê°€ë¡œ ì‚¬ì´ì¦ˆ  containerì— ë§ì¶”ê¸°

```js
const PhotoFile = styled.img`
    width : 100%;
`
...
<PhotoContainer>
	<PhotoFile src={photo.file} />
</PhotoContainer>
```

2. under the photo

```js
// êµ¬ì¡°
<PhotoData>
    <PhotoActions> // ì¢‹ì•„ìš”, ì½”ë©˜íŠ¸, ë©”ì„¸ì§€, ë¶ë§ˆí¬ ì•„ì´ì½˜ìˆëŠ” row
    	<div>
            <PhotoAction> // heart
            <PhotoAction>  // comment
            <PhotoAction>  // airplane
    	</div>
		<div>
    		// bookmark icon
        </div>
```

- PhotoActions ìŠ¤íƒ€ì¼ ì°¸ê³ 

```js
const PhotoActions = styled.div`
	// heart, comment, airplaneê³¼ bookmark ì‚¬ì´
    display:flex;
    align-items:center;
    justify-content : space-between;
    padding : 15px;
    div {  // heart, comment, airplaneë¼ë¦¬
        display:flex;
        align-items: center;
    }
`
```

3. ì¢‹ì•„ìš” ê°œìˆ˜ (just FatText)

- like === 1 ì¸ ê²½ìš° like, ë‚˜ë¨¸ì§€ likes

- â• display : block ) div ê¸°ë³¸ê°’, widthê°€ ìì‹ ì˜ ì»¨í…Œì´ë„ˆì˜ 100%

